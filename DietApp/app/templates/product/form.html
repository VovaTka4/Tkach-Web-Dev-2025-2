{% macro product_form(product=None) %}
<form method="post" enctype="multipart/form-data" novalidate>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="name" class="form-label">Название продукта</label>
                <input type="text" name="name" id="name" class="form-control"
                       value="{{ product.product_name if product else '' }}" required>
            </div>

            {% for field, label in [('calories', 'Калорийность на 100г'),
                                    ('protein', 'Белки на 100г'),
                                    ('fat', 'Жиры на 100г'),
                                    ('carbs', 'Углеводы на 100г')] %}
            <div class="mb-3">
                <label for="{{ field }}" class="form-label">{{ label }}</label>
                <input type="number" step="0.1" min="0" name="{{ field }}" id="{{ field }}"
                       class="form-control"
                       value="{{ getattr(product, field, '') if product else '' }}" required>
            </div>
            {% endfor %}
        </div>

        <div class="col-md-4 text-center">
            <div class="mb-3">
                <img id="preview-image"
                     src="{{ url_for('static', filename=product.img_path if product and product.img_path else 'img/placeholder.png') }}"
                     class="img-fluid border rounded" style="max-height: 250px;" alt="Превью изображения">
            </div>
            <div class="mb-3">
                <label for="image" class="form-label">Выбрать изображение</label>
                <input type="file" name="image" id="image" accept="image/*" class="form-control">
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <button type="submit" class="btn btn-success">Сохранить продукт</button>
    </div>
</form>

<script>
document.getElementById('image').addEventListener('change', function(event) {
    const [file] = event.target.files;
    if (file) {
        const preview = document.getElementById('preview-image');
        preview.src = URL.createObjectURL(file);
    }
});
</script>
{% endmacro %}